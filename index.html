<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Links Tributário</title>
  <style>
    body{font-family:sans-serif; background:#0b0f19; color:#e8eef8; display:flex; justify-content:center; padding:20px}
    .wrap{max-width:600px; width:100%; background:#121829; padding:20px; border-radius:8px}
    input{width:100%; padding:10px; margin-bottom:10px; border-radius:6px; border:1px solid #333; background:#0e1526; color:white}
    button{padding:10px 16px; border:none; background:#4f80ff; color:white; border-radius:6px; cursor:pointer}
    .item{background:#0e1526; padding:10px; margin-top:10px; border-radius:6px; display:flex; justify-content:space-between; align-items:center}
    .empty{color:#9aa4b2; margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Links Tributário</h1>
    <p>Digite o que deseja abrir. Ex.: <i>planilha de vendas</i>, <i>difal</i>.</p>
    <input id="q" type="search" placeholder="Buscar...">
    <button id="btnOpen">Abrir 1º</button>
    <div id="results"></div>
  </div>

<script>
function norm(s){return (s||"").normalize("NFD").replace(/[\u0300-\u036f]/g,'').toLowerCase();}
function score(item, query){
  const nq = norm(query);
  const title = norm(item.title);
  const tags = (item.tags||[]).map(norm).join(" ");
  let s = 0;
  if(title.includes(nq)) s += 10;
  if(tags.includes(nq)) s += 6;
  const terms = nq.split(/\s+/).filter(Boolean);
  for(const t of terms){
    if(title.includes(t)) s += 3;
    if(tags.includes(t)) s += 2;
  }
  return s;
}
async function loadData(){
  try {
    const res = await fetch("links.json", {cache:"no-store"});
    const data = await res.json();
    console.log("links.json carregado:", data);
    return data;
  } catch(e){
    console.error("Erro ao carregar links.json:", e);
    return [];
  }
}
function render(items){
  const root = document.getElementById("results");
  root.innerHTML = "";
  if(!items.length){
    root.innerHTML = '<div class="empty">Nenhum resultado encontrado</div>';
    return;
  }
  items.forEach(it => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `<span>${it.title}</span>
      <a href="${it.url}" target="_blank"><button>Abrir</button></a>`;
    root.appendChild(div);
  });
}
async function main(){
  const data = await loadData();
  const q = document.getElementById("q");
  const btn = document.getElementById("btnOpen");
  function update(){
    const query = q.value.trim();
    if(!query){ render(data); return; }
    const ranked = data
      .map(d => ({...d, _s: score(d, query)}))
      .filter(d => d._s > 0)
      .sort((a,b) => b._s - a._s);
    render(ranked);
  }
  q.addEventListener("input", update);
  q.addEventListener("keydown", ev => {
    if(ev.key === "Enter"){
      const first = document.querySelector(".item a");
      if(first) first.click();
    }
  });
  btn.addEventListener("click", ()=>{
    const first = document.querySelector(".item a");
    if(first) first.click();
  });
  render(data);
}
main();
</script>
</body>
</html>
